<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BTC Mini Trader</title>

  <style>
    :root { --bg:#0b1220; --card:#111a2c; --text:#e6eefc; --muted:#9bb0d0; }
    *{ box-sizing:border-box; }
    body{
      margin:0; padding:16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg); color: var(--text);
    }
    .wrap{ max-width:520px; margin:0 auto; }
    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .title{ font-size:18px; margin:0 0 10px 0; }
    .price{
      font-size:34px; font-weight:800; letter-spacing: .2px;
      margin: 0 0 4px 0;
    }
    .sub{ color: var(--muted); margin:0 0 12px 0; font-size:13px; }

    .chartWrap{
      margin: 8px 0 14px 0;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    canvas{ display:block; width:100%; height:170px; }

    .row{ display:flex; gap:12px; }
    button{
      width:100%;
      padding:14px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      background: rgba(255,255,255,.06);
      font-size:16px;
      font-weight:700;
      cursor:pointer;
      user-select:none;
    }
    .hidden{ display:none !important; }

    .pnlBox{
      margin-top:14px;
      padding:12px;
      border-radius: 12px;
      border: 1px dashed rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
    }
    .pnlLabel{ color: var(--muted); font-size:13px; margin:0 0 6px 0; }
    .pnlValue{ font-size:22px; font-weight:800; margin:0; }
    .small{ color: var(--muted); font-size:12px; margin-top:10px; }
    .tag{
      display:inline-block;
      padding:4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      font-size:12px; color: var(--muted);
      margin-left:8px;
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1 class="title">–ú–∏–Ω–∏-—Ç—Ä–µ–π–¥–µ—Ä BTC/USD <span id="posTag" class="tag hidden"></span></h1>

      <p class="price" id="price">$45,000.00</p>
      <p class="sub">–ö—É—Ä—Å –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –Ω–∞ ¬±1% (—Å–ª—É—á–∞–π–Ω–æ). –ì—Ä–∞—Ñ–∏–∫: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–≤–µ—á–µ–π.</p>

      <div class="chartWrap">
        <canvas id="chart" width="520" height="170"></canvas>
      </div>

      <div class="row" id="entryRow">
        <button id="longBtn">–õ–æ–Ω–≥</button>
        <button id="shortBtn">–®–æ—Ä—Ç</button>
      </div>

      <div class="row hidden" id="closeRow">
        <button id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>

      <div class="pnlBox hidden" id="pnlBox">
        <p class="pnlLabel">–¢–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (PnL)</p>
        <p class="pnlValue" id="pnlValue">0.00%</p>
        <div class="small" id="pnlDetails"></div>
      </div>
    </div>
  </div>

  <script>
    // --- State
    let price = 45000;
    let position = null; // 'long' | 'short' | null
    let entryPrice = null;
    let lastPnl = 0;

    // Candles: [{o,h,l,c}]
    const MAX_CANDLES = 10;
    const candles = [];

    // --- DOM
    const priceEl = document.getElementById('price');
    const longBtn = document.getElementById('longBtn');
    const shortBtn = document.getElementById('shortBtn');
    const closeBtn = document.getElementById('closeBtn');
    const entryRow = document.getElementById('entryRow');
    const closeRow = document.getElementById('closeRow');
    const pnlBox = document.getElementById('pnlBox');
    const pnlValue = document.getElementById('pnlValue');
    const pnlDetails = document.getElementById('pnlDetails');
    const posTag = document.getElementById('posTag');

    const canvas = document.getElementById('chart');
    const ctx = canvas.getContext('2d');

    // Make canvas crisp on HiDPI
    function resizeCanvasToDisplaySize() {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      const w = Math.round(rect.width * dpr);
      const h = Math.round(rect.height * dpr);
      if (canvas.width !== w || canvas.height !== h) {
        canvas.width = w;
        canvas.height = h;
      }
    }

    // --- Helpers
    function fmtMoney(x) {
      return x.toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2 });
    }
    function fmtPct(x) {
      const sign = x > 0 ? '+' : '';
      return `${sign}${x.toFixed(2)}%`;
    }
    function randomStepWithin1pct() {
      return (Math.random() * 2 - 1) * 0.01; // -1%..+1%
    }
    function randBetween(a, b) { return a + Math.random() * (b - a); }

    function calcPnlPercent() {
      if (!position || !entryPrice) return 0;
      if (position === 'long') return (price / entryPrice - 1) * 100;
      return (entryPrice / price - 1) * 100; // short
    }

    function renderPrice() {
      priceEl.textContent = fmtMoney(price);
    }

    function renderPnl() {
      lastPnl = calcPnlPercent();
      pnlValue.textContent = (lastPnl >= 0 ? 'üü¢ ' : 'üî¥ ') + fmtPct(lastPnl);
      pnlDetails.textContent = `–í—Ö–æ–¥: ${fmtMoney(entryPrice)} ‚Ä¢ –°–µ–π—á–∞—Å: ${fmtMoney(price)}`;
    }

    function resetUI() {
      position = null;
      entryPrice = null;
      lastPnl = 0;

      entryRow.classList.remove('hidden');
      closeRow.classList.add('hidden');
      pnlBox.classList.add('hidden');

      posTag.classList.add('hidden');
      posTag.textContent = '';
    }

    // --- Trading
    function openPosition(type) {
      if (position) return;
      position = type;
      entryPrice = price;

      entryRow.classList.add('hidden');
      closeRow.classList.remove('hidden');

      pnlBox.classList.remove('hidden');
      posTag.textContent = type.toUpperCase();
      posTag.classList.remove('hidden');

      renderPnl();
    }

    function closePosition() {
      if (!position) return;

      renderPnl();
      const text =
        `${position.toUpperCase()} ‚Ä¢ –í—Ö–æ–¥: ${fmtMoney(entryPrice)} ‚Üí –í—ã—Ö–æ–¥: ${fmtMoney(price)}\n` +
        `–ò—Ç–æ–≥: ${fmtPct(lastPnl)}`;

      alert(text);
      resetUI();
    }

    // --- Candles
    function pushCandle(open, close) {
      // –¥–µ–ª–∞–µ–º —Ñ–∏—Ç–∏–ª–∏ (high/low) —á—É—Ç—å —à–∏—Ä–µ, —á–µ–º —Ç–µ–ª–æ
      const baseHi = Math.max(open, close);
      const baseLo = Math.min(open, close);

      // —Å–ª—É—á–∞–π–Ω—ã–µ "—Ñ–∏—Ç–∏–ª–∏" –¥–æ ~0.3% –æ—Ç —Ü–µ–Ω—ã
      const wickUp = baseHi * randBetween(0, 0.003);
      const wickDn = baseLo * randBetween(0, 0.003);

      const high = baseHi + wickUp;
      const low = Math.max(1, baseLo - wickDn);

      candles.push({ o: open, h: high, l: low, c: close });
      while (candles.length > MAX_CANDLES) candles.shift();
    }

    function seedCandles() {
      // –Ω–∞—á–∞–ª—å–Ω—ã–µ 10 —Å–≤–µ—á–µ–π, —á—Ç–æ–±—ã –≥—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–∑—É –±—ã–ª –∑–∞–ø–æ–ª–Ω–µ–Ω
      let p = price;
      for (let i = 0; i < MAX_CANDLES; i++) {
        const step = randomStepWithin1pct();
        const next = Math.max(p * (1 + step), 1);
        pushCandle(p, next);
        p = next;
      }
      price = p;
      renderPrice();
    }

    // --- Chart drawing
    function drawChart() {
      resizeCanvasToDisplaySize();
      const W = canvas.width, H = canvas.height;

      // background
      ctx.clearRect(0, 0, W, H);

      const pad = Math.round(12 * (window.devicePixelRatio || 1));
      const innerW = W - pad * 2;
      const innerH = H - pad * 2;

      // if no data
      if (candles.length === 0) return;

      // Determine scale from highs/lows
      let hi = -Infinity, lo = Infinity;
      for (const c of candles) {
        if (c.h > hi) hi = c.h;
        if (c.l < lo) lo = c.l;
      }

      // add small margin
      const margin = (hi - lo) * 0.08 || hi * 0.01;
      hi += margin;
      lo -= margin;

      function yOf(val) {
        const t = (val - lo) / (hi - lo);
        return pad + (innerH * (1 - t));
      }

      // grid (simple 3 horizontal lines)
      ctx.globalAlpha = 0.35;
      ctx.strokeStyle = 'rgba(255,255,255,0.20)';
      ctx.lineWidth = 1;
      for (let i = 1; i <= 3; i++) {
        const y = pad + innerH * (i / 4);
        ctx.beginPath();
        ctx.moveTo(pad, y);
        ctx.lineTo(pad + innerW, y);
        ctx.stroke();
      }
      ctx.globalAlpha = 1;

      const n = candles.length;
      const slot = innerW / n;
      const bodyW = Math.max(3, slot * 0.55);

      for (let i = 0; i < n; i++) {
        const c = candles[i];
        const xCenter = pad + slot * (i + 0.5);

        const yOpen = yOf(c.o);
        const yClose = yOf(c.c);
        const yHigh = yOf(c.h);
        const yLow  = yOf(c.l);

        const isGreen = c.c >= c.o;

        // wick
        ctx.strokeStyle = isGreen ? 'rgba(0,255,140,0.85)' : 'rgba(255,70,70,0.85)';
        ctx.lineWidth = Math.max(1, bodyW * 0.12);
        ctx.beginPath();
        ctx.moveTo(xCenter, yHigh);
        ctx.lineTo(xCenter, yLow);
        ctx.stroke();

        // body
        const top = Math.min(yOpen, yClose);
        const bottom = Math.max(yOpen, yClose);
        const bodyH = Math.max(2, bottom - top);

        ctx.fillStyle = isGreen ? 'rgba(0,255,140,0.85)' : 'rgba(255,70,70,0.85)';
        ctx.fillRect(
          xCenter - bodyW / 2,
          top,
          bodyW,
          bodyH
        );
      }
    }

    // --- Events
    longBtn.addEventListener('click', () => openPosition('long'));
    shortBtn.addEventListener('click', () => openPosition('short'));
    closeBtn.addEventListener('click', closePosition);
    window.addEventListener('resize', drawChart);

    // --- Main loop (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
    function tick() {
      const open = price;
      const step = randomStepWithin1pct();
      const close = Math.max(open * (1 + step), 1);

      price = close;

      pushCandle(open, close);
      renderPrice();
      drawChart();

      if (position) renderPnl();
    }

    // —Å—Ç–∞—Ä—Ç
    seedCandles();
    drawChart();
    setInterval(tick, 1000);
  </script>
</body>
</html>


